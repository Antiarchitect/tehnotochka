# -*- encoding: utf-8 -*- 
module RuTils
  module Transliteration #:nodoc:
  end
end

require File.join(File.dirname(__FILE__), 'simple')

# Заглушка
require File.join(File.dirname(__FILE__), 'bidi')

=begin
Реализует транслитерацию любого объекта, реализующего String или to_s.
=== Почему удален BiDi-транслит?

В отличие от DHH авторы RuTils придерживаются стратегии синтактической серной кислоты вместо синтактического уксуса. Основная область
применения bidi-транслитераций - генерация "как-бы" более удобочитаемых URL. К сожалению, у нее есть ряд свойств которые делают ее
бессмысленной (кроме как в качестве упражнения по строковым итераторам Ruby). Приводим список аргументов почему вам не нужны
автоматические транслитерированные URL:

* Они будут работать только для набора символов "ASCII + русский". Любая попытка засунуть в ваш URL слово stød закончится печально.
* Они будут работать только для русского языка, кириллиц много. Транслитерация по определению языкозависима.
* Вашим пользователям придется непрерывно угадывать, пишется буква "я". "Ja"?  "Ya"? "J"? Если вы хоть раз наблюдали иностранца, пытающегося
  выговорить "ОВИРскую" транслитерацию вашей фамилии из загранпаспорта, вы знаете о чем мы говорим.
* Приличные браузеры не кодируют русский текст в адресной строке если Ваш вебсервер его принял. Если браузер неприличный то он позволяет этот текст ввести.
  Если браузер совсем неприличный, то средство ввода у него - стилус размером с зубочистку, а пользуются им в трамвае. Вводить ваш транслит
  в таких условиях все равно никто не будет, успокойтесь.
  
Приводить список аргументов "почему такой транслит вам нужен" мы не будем дабы никого не травмировать.

Если вам таки страшно неймется реализовать транслит в URL, рекомендуем следующий подход:

* Для адресуемого обьекта сохраняется поле ++slug++
* При сохранении в это поле автоматически пишется "дирифицированное" название, но пользователь может его вручную отредактировать
* Дальнейшая адресация производится без "транслитерации обратно", по полю slug напрямую

Дополнительно рекомендуется запретить загрузку файлов с русскими именами (с помощью Javascript и свойства value элемента input).
=end
module RuTils::Transliteration::StringFormatting
  
  # Транслитерирует строку в латиницу, и возвращает измененную строку
  def translify
    RuTils::Transliteration::Simple::translify(self.to_s)
  end

  # Транслитерирует строку, меняя объект  
  def translify!
    self.replace(self.translify)
  end
  
  # Транслитерирует строку, делая ее пригодной для применения как имя директории или URL
  def dirify
    RuTils::Transliteration::Simple::dirify(self.to_s)
  end
  
  # ++DEPRECATED++ Вызывает ошибку
  def bidi_translify(allow_slashes = true)
    RuTils::Transliteration::BiDi.bail!
  end
  
  # ++DEPRECATED++ Вызывает ошибку
  def bidi_translify!(allow_slashes = true)
    RuTils::Transliteration::BiDi.bail!
  end

  # ++DEPRECATED++ Вызывает ошибку
  def bidi_detranslify!(allow_slashes = true)
    RuTils::Transliteration::BiDi.bail!
  end
  
  # ++DEPRECATED++ Вызывает ошибку
  def bidi_detranslify(allow_slashes = true)
    RuTils::Transliteration::BiDi.bail!
  end
end

class Object::String
  include RuTils::Transliteration::StringFormatting
end